[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2019-03-27 17:35:42.443655", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on(\"Sales Invoice\", {\n    refresh: function(frm) {\n       \n        if (frm.doc.docstatus==1  ) {\n        if (frappe.user.has_role('SMS Alert Manager')){\n\n        cur_frm.add_custom_button(__('Send SMS'), \n            function() { \n\n    var dialog = new frappe.ui.Dialog({\n    title: __(\"Send SMS\"),\n    fields: [\n        {\"fieldtype\": \"Data\", \"label\": __(\"Please Enter  Mobile Number\"), \"fieldname\": \"mob_num\",\n            \"reqd\": 1 ,\n        },\n        {\"fieldtype\": \"Text\", \"label\": __(\"Message Box\"), \"fieldname\": \"msg_box\",\n            \"reqd\": 1 ,\n        },\n        {\"fieldtype\": \"Button\", \"label\": __(\"Send\"), \"fieldname\": \"update1\"},\n    ]\n}); \n    dialog.fields_dict.update1.input.onclick = function() {\n    var mob_num = $(\"input[data-fieldname='mob_num']\").val(); \n    // var msg_box = $(\"input[text-fieldname='msg_box']\").val(); \n    var values = dialog.get_values();\n\n        frm.call({\n          //    doc: frm.doc,\n              args: { doctype: \"Sales Invoice\" , mob_num : mob_num , msg_box : values.msg_box },\n              method: \"ecorex_app_erpnext.hooks_call.sales_invoice.send_msg\",\n              callback: function(r) {\n                // frm.clear_table(\"required_items\")\n\n          }\n            }); \n    },\n\n    dialog.show();\n    var j = \"Dear Valued Customer , We have shipped your material \"\n\n\n    $.each(frm.doc.items, function(index,row)\n    {\n        if(frm.doc.items.length != index+1 )\n        {\n\n            j = j + row.item_name +\"  \"+row.qty +\",\"\n\n        }else \n           {\n\n            j = j + row.item_name +\"  \"+row.qty+\" \"+row.uom+\" via vehicle number \"+frm.doc.vehicle_no+\" (Driver's Name and Contact No. -\"+frm.doc.driver_name +\") for your reference.Thank you for your order.\"\n\n        } \n\n    });\n        frappe.call({\n       \"method\": \"frappe.client.get\",\n        args: {\n            doctype: \"Address\",\n            name: frm.doc.customer_address\n        },\n        callback: function(r) {\n           if(r.message){\n            dialog.set_value('mob_num', r.message.sms_alert_phone_no );\n\n          }\n\n        }\n    });\n    dialog.set_value('msg_box', j );\n\n\n\n\n                \n            },\n           );\n    \n\n}\n}\n\n\n\n}\n\n});\n", 
  "script_type": "Client"
 }
]